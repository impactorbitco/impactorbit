---
import Layout from '../../layouts/Layout.astro';
import Hero from '../../components/Hero.astro';
import { getCollection } from 'astro:content';
import { slug as slugify } from 'github-slugger';

/* -------------------------------------------
   Load blog collection
-------------------------------------------- */
const posts = await getCollection('blog');

// Collect unique tags across all posts
const tagsSet = new Set();
posts.forEach(post => {
  if (Array.isArray(post.data.tags)) {
    post.data.tags.forEach(tag => tagsSet.add(tag.trim()));
  }
});

// Sort tags alphabetically
const tags = Array.from(tagsSet).sort((a, b) => a.localeCompare(b));
---

<Layout title="Tags" description="Browse insight posts by topic tags.">
  <main class="py-12 w-full">
    <Hero
      title="Tags"
      description="Explore our posts by topics and categories. Click a tag to see all related articles."
    />

    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-12">
      <ul class="flex flex-wrap gap-3">
        {tags.map(tag => (
          <li>
            <a
              href={`/tags/${slugify(tag)}/`}
              class="inline-block px-4 py-2 bg-gray-100 text-gray-800 rounded-full hover:bg-gray-200 transition"
            >
              {tag}
            </a>
          </li>
        ))}
      </ul>
    </section>

    <!-- CTA Section -->
    <section class="mt-16 py-16 bg-secondary-500 text-white text-center w-full">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl sm:text-4xl font-bold mb-4">Stay Updated on Sustainable Space</h2>
        <p class="mb-8 text-lg sm:text-xl text-gray-200">
          Subscribe to our newsletter for the latest insights on space, sustainability, and innovation.
        </p>
        <a
          href="/newsletter"
          class="inline-block px-8 py-4 bg-accent-500 hover:bg-accent-600 text-white font-semibold rounded-lg transition text-lg sm:text-xl"
        >
          Subscribe Now
        </a>
      </div>
    </section>
  </main>
</Layout>